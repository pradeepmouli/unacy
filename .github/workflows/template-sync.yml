name: Template Sync

on:
  # Manually trigger the workflow
  workflow_dispatch:
  # Run on push to master branch
  push:
    branches:
      - master
  # Run on schedule (weekly on Mondays at 9 AM UTC)
  schedule:
    - cron: '0 9 * * 1'

jobs:
  sync-template:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    strategy:
      matrix:
        # List downstream repositories that should be kept in sync
        # Format: 'owner/repository'
        repo:
          - 'pradeepmouli/downstream-repo-1'
          # - 'pradeepmouli/downstream-repo-2'
          # Add more repositories as needed

    steps:
      - name: Checkout downstream repository
        uses: actions/checkout@v4
        with:
          # Checkout the downstream repo instead of this template
          repository: ${{ matrix.repo }}
          token: ${{ secrets.TEMPLATE_SYNC_TOKEN }}
          fetch-depth: 0
          persist-credentials: false

      - name: Sync template into downstream repository
        uses: AndreasAugustin/actions-template-sync@v2
        with:
          # Token must have access to source (read) and target (write + workflow)
          source_gh_token: ${{ secrets.TEMPLATE_SYNC_TOKEN }}
          target_gh_token: ${{ secrets.TEMPLATE_SYNC_TOKEN }}
          source_repo_path: pradeepmouli/template-ts
          upstream_branch: master
          pr_branch_name_prefix: template-sync
          pr_title: 'chore: sync template changes from upstream'
          pr_commit_msg: 'chore: sync template changes'
          pr_labels: 'template-sync,automated'
